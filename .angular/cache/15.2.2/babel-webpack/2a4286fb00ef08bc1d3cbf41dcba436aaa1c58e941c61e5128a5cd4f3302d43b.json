{"ast":null,"code":"import { ElementRef } from '@angular/core';\nimport { Dimension } from '../../../../model/IRenderable';\nimport { GridMedia } from '../GridMedia';\nimport { RouterLink } from '@angular/router';\nimport { ThumbnailManagerService } from '../../thumbnailManager.service';\nimport { Config } from '../../../../../../common/config/public/Config';\nimport { PageHelper } from '../../../../model/page.helper';\nimport { SearchQueryTypes, TextSearchQueryMatchTypes } from '../../../../../../common/entities/SearchQueryDTO';\nimport { AuthenticationService } from '../../../../model/network/authentication.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../thumbnailManager.service\";\nimport * as i2 from \"../../../../model/network/authentication.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"./loading/loading.photo.grid.gallery.component\";\nimport * as i6 from \"../../../../pipes/DurationPipe\";\nconst _c0 = [\"img\"];\nconst _c1 = [\"photoContainer\"];\nfunction GalleryPhotoComponent_img_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 6, 7);\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵpropertyInterpolate(\"alt\", ctx_r1.gridMedia.media.name);\n    i0.ɵɵproperty(\"src\", ctx_r1.thumbnail.Src, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction GalleryPhotoComponent_app_gallery_grid_photo_loading_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-gallery-grid-photo-loading\", 8);\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"error\", ctx_r2.thumbnail.Error)(\"animate\", ctx_r2.thumbnail.loading);\n  }\n}\nfunction GalleryPhotoComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"duration\");\n    i0.ɵɵelement(3, \"span\", 10);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, ctx_r3.gridMedia.Video.metadata.duration), \" \");\n  }\n}\nconst _c2 = function (a1) {\n  return [\"/search\", a1];\n};\nfunction GalleryPhotoComponent_div_5_div_3_ng_template_2_a_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext(4);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(2, _c2, ctx_r9.getPositionSearchQuery()));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r9.getPositionText(), \" \");\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_3_ng_template_2_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r10.getPositionText());\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_3_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, GalleryPhotoComponent_div_5_div_3_ng_template_2_a_0_Template, 2, 4, \"a\", 18);\n    i0.ɵɵtemplate(1, GalleryPhotoComponent_div_5_div_3_ng_template_2_span_1_Template, 2, 1, \"span\", 19);\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r8.searchEnabled);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r8.searchEnabled);\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelement(1, \"span\", 16);\n    i0.ɵɵtemplate(2, GalleryPhotoComponent_div_5_div_3_ng_template_2_Template, 2, 2, \"ng-template\", 17);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.getPositionText());\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_ng_template_1_a_0_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"#\");\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_ng_template_1_a_0_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 27);\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_ng_template_1_a_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 25);\n    i0.ɵɵtemplate(1, GalleryPhotoComponent_div_5_div_4_ng_template_1_a_0_ng_template_1_Template, 1, 0, \"ng-template\", 26);\n    i0.ɵɵtemplate(2, GalleryPhotoComponent_div_5_div_4_ng_template_1_a_0_ng_template_2_Template, 1, 0, \"ng-template\", 26);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const keyword_r12 = i0.ɵɵnextContext().$implicit;\n    const ctx_r14 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(5, _c2, ctx_r14.getTextSearchQuery(keyword_r12.value, keyword_r12.type)))(\"ngSwitch\", keyword_r12.type);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", ctx_r14.SearchQueryTypes.keyword);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", ctx_r14.SearchQueryTypes.person);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(keyword_r12.value);\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_ng_template_1_span_1_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"#\");\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_ng_template_1_span_1_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 27);\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_ng_template_1_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 28);\n    i0.ɵɵtemplate(1, GalleryPhotoComponent_div_5_div_4_ng_template_1_span_1_ng_template_1_Template, 1, 0, \"ng-template\", 26);\n    i0.ɵɵtemplate(2, GalleryPhotoComponent_div_5_div_4_ng_template_1_span_1_ng_template_2_Template, 1, 0, \"ng-template\", 26);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const keyword_r12 = i0.ɵɵnextContext().$implicit;\n    const ctx_r15 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"ngSwitch\", keyword_r12.type);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", ctx_r15.SearchQueryTypes.keyword);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", ctx_r15.SearchQueryTypes.person);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(keyword_r12.value);\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_ng_template_1_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \",\\u00A0\");\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, GalleryPhotoComponent_div_5_div_4_ng_template_1_a_0_Template, 4, 7, \"a\", 23);\n    i0.ɵɵtemplate(1, GalleryPhotoComponent_div_5_div_4_ng_template_1_span_1_Template, 4, 4, \"span\", 24);\n    i0.ɵɵtemplate(2, GalleryPhotoComponent_div_5_div_4_ng_template_1_ng_template_2_Template, 1, 0, \"ng-template\", 17);\n  }\n  if (rf & 2) {\n    const last_r13 = ctx.last;\n    const ctx_r11 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r11.searchEnabled);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r11.searchEnabled);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !last_r13);\n  }\n}\nfunction GalleryPhotoComponent_div_5_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtemplate(1, GalleryPhotoComponent_div_5_div_4_ng_template_1_Template, 3, 3, \"ng-template\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r7.keywords);\n  }\n}\nfunction GalleryPhotoComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\", 12);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, GalleryPhotoComponent_div_5_div_3_Template, 3, 1, \"div\", 13);\n    i0.ɵɵtemplate(4, GalleryPhotoComponent_div_5_div_4_Template, 2, 1, \"div\", 14);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r4.Title);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.gridMedia.hasPositionData());\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.keywords);\n  }\n}\nexport let GalleryPhotoComponent = /*#__PURE__*/(() => {\n  class GalleryPhotoComponent {\n    constructor(thumbnailService, authService) {\n      this.thumbnailService = thumbnailService;\n      this.authService = authService;\n      this.keywords = null;\n      this.infoBarVisible = false;\n      this.animationTimer = null;\n      this.SearchQueryTypes = SearchQueryTypes;\n      this.searchEnabled = true;\n      this.wasInView = null;\n      this.searchEnabled = this.authService.canSearch();\n    }\n    get ScrollListener() {\n      return !this.thumbnail.Available && !this.thumbnail.Error;\n    }\n    get Title() {\n      if (Config.Gallery.captionFirstNaming === false) {\n        return this.gridMedia.media.name;\n      }\n      if (this.gridMedia.media.metadata.caption) {\n        if (this.gridMedia.media.metadata.caption.length > 20) {\n          return this.gridMedia.media.metadata.caption.substring(0, 17) + '...';\n        }\n        return this.gridMedia.media.metadata.caption;\n      }\n      return this.gridMedia.media.name;\n    }\n    ngOnInit() {\n      this.thumbnail = this.thumbnailService.getThumbnail(this.gridMedia);\n      const metadata = this.gridMedia.media.metadata;\n      if (metadata.keywords && metadata.keywords.length > 0 || metadata.faces && metadata.faces.length > 0) {\n        this.keywords = [];\n        if (Config.Faces.enabled) {\n          const names = (metadata.faces || []).map(f => f.name);\n          this.keywords = names.filter((name, index) => names.indexOf(name) === index).map(n => ({\n            value: n,\n            type: SearchQueryTypes.person\n          }));\n        }\n        this.keywords = this.keywords.concat((metadata.keywords || []).map(k => ({\n          value: k,\n          type: SearchQueryTypes.keyword\n        })));\n      }\n    }\n    ngOnDestroy() {\n      this.thumbnail.destroy();\n      if (this.animationTimer != null) {\n        clearTimeout(this.animationTimer);\n      }\n    }\n    isInView() {\n      return PageHelper.ScrollY < this.container.nativeElement.offsetTop + this.container.nativeElement.clientHeight && PageHelper.ScrollY + window.innerHeight > this.container.nativeElement.offsetTop;\n    }\n    onScroll() {\n      if (this.thumbnail.Available === true || this.thumbnail.Error === true) {\n        return;\n      }\n      const isInView = this.isInView();\n      if (this.wasInView !== isInView) {\n        this.wasInView = isInView;\n        this.thumbnail.Visible = isInView;\n      }\n    }\n    getPositionSearchQuery() {\n      return JSON.stringify({\n        type: SearchQueryTypes.position,\n        matchType: TextSearchQueryMatchTypes.exact_match,\n        text: this.getPositionText()\n      });\n    }\n    getTextSearchQuery(name, type) {\n      return JSON.stringify({\n        type,\n        matchType: TextSearchQueryMatchTypes.exact_match,\n        text: name\n      });\n    }\n    getPositionText() {\n      if (!this.gridMedia || !this.gridMedia.isPhoto()) {\n        return '';\n      }\n      return this.gridMedia.media.metadata.positionData.city || this.gridMedia.media.metadata.positionData.state || this.gridMedia.media.metadata.positionData.country;\n    }\n    mouseOver() {\n      this.infoBarVisible = true;\n      if (this.animationTimer != null) {\n        clearTimeout(this.animationTimer);\n        this.animationTimer = null;\n      }\n    }\n    mouseOut() {\n      if (this.animationTimer != null) {\n        clearTimeout(this.animationTimer);\n      }\n      this.animationTimer = window.setTimeout(() => {\n        this.animationTimer = null;\n        this.infoBarVisible = false;\n      }, 500);\n    }\n    getDimension() {\n      if (!this.imageRef) {\n        return {\n          top: 0,\n          left: 0,\n          width: 0,\n          height: 0\n        };\n      }\n      return {\n        top: this.imageRef.nativeElement.offsetParent.offsetTop,\n        left: this.imageRef.nativeElement.offsetParent.offsetLeft,\n        width: this.imageRef.nativeElement.width,\n        height: this.imageRef.nativeElement.height\n      };\n    }\n  }\n  GalleryPhotoComponent.ɵfac = function GalleryPhotoComponent_Factory(t) {\n    return new (t || GalleryPhotoComponent)(i0.ɵɵdirectiveInject(i1.ThumbnailManagerService), i0.ɵɵdirectiveInject(i2.AuthenticationService));\n  };\n  GalleryPhotoComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: GalleryPhotoComponent,\n    selectors: [[\"app-gallery-grid-photo\"]],\n    viewQuery: function GalleryPhotoComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 7);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.imageRef = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.container = _t.first);\n      }\n    },\n    inputs: {\n      gridMedia: \"gridMedia\"\n    },\n    features: [i0.ɵɵProvidersFeature([RouterLink])],\n    decls: 6,\n    vars: 4,\n    consts: [[1, \"photo-container\", 3, \"mouseover\", \"mouseout\"], [\"photoContainer\", \"\"], [3, \"alt\", \"src\", 4, \"ngIf\"], [3, \"error\", \"animate\", 4, \"ngIf\"], [\"class\", \"video-indicator\", 4, \"ngIf\"], [\"class\", \"info\", 4, \"ngIf\"], [3, \"alt\", \"src\"], [\"img\", \"\"], [3, \"error\", \"animate\"], [1, \"video-indicator\"], [1, \"oi\", \"oi-video\"], [1, \"info\"], [1, \"photo-name\"], [\"class\", \"photo-position\", 4, \"ngIf\"], [\"class\", \"photo-keywords\", 4, \"ngIf\"], [1, \"photo-position\"], [1, \"oi\", \"oi-map-marker\"], [3, \"ngIf\"], [3, \"routerLink\", 4, \"ngIf\"], [4, \"ngIf\"], [3, \"routerLink\"], [1, \"photo-keywords\"], [\"ngFor\", \"\", 3, \"ngForOf\"], [3, \"routerLink\", \"ngSwitch\", 4, \"ngIf\"], [3, \"ngSwitch\", 4, \"ngIf\"], [3, \"routerLink\", \"ngSwitch\"], [3, \"ngSwitchCase\"], [1, \"oi\", \"oi-person\"], [3, \"ngSwitch\"]],\n    template: function GalleryPhotoComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0, 1);\n        i0.ɵɵlistener(\"mouseover\", function GalleryPhotoComponent_Template_div_mouseover_0_listener() {\n          return ctx.mouseOver();\n        })(\"mouseout\", function GalleryPhotoComponent_Template_div_mouseout_0_listener() {\n          return ctx.mouseOut();\n        });\n        i0.ɵɵtemplate(2, GalleryPhotoComponent_img_2_Template, 2, 2, \"img\", 2);\n        i0.ɵɵtemplate(3, GalleryPhotoComponent_app_gallery_grid_photo_loading_3_Template, 1, 2, \"app-gallery-grid-photo-loading\", 3);\n        i0.ɵɵtemplate(4, GalleryPhotoComponent_div_4_Template, 4, 3, \"div\", 4);\n        i0.ɵɵtemplate(5, GalleryPhotoComponent_div_5_Template, 5, 3, \"div\", 5);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.thumbnail.Available);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.thumbnail.Available);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.gridMedia.isVideo());\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.infoBarVisible);\n      }\n    },\n    dependencies: [i3.NgForOf, i3.NgIf, i3.NgSwitch, i3.NgSwitchCase, i4.RouterLink, i5.GalleryPhotoLoadingComponent, i6.DurationPipe],\n    styles: [\"[_nghost-%COMP%]{position:relative;overflow:hidden}img[_ngcontent-%COMP%]{width:inherit;height:inherit;animation:_ngcontent-%COMP%_fadein 2s;vertical-align:unset}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}.photo-container[_ngcontent-%COMP%]:hover   .info[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_show-info .3s forwards}@keyframes _ngcontent-%COMP%_show-info{0%{transform:translateY(0);background-color:transparent}to{transform:translateY(-100%);background:rgba(0,0,0,.8)}}@keyframes _ngcontent-%COMP%_hide-info{0%{transform:translateY(-100%);background:rgba(0,0,0,.8)}to{transform:translateY(0);background-color:transparent}}.info[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_hide-info .3s forwards;transform:translateY(0);background-color:transparent;color:#fff;font-size:medium;display:table-caption;position:absolute;padding:5px;width:100%;margin-top:0;transition:transform .3s ease-out,background-color .3s ease-out;-moz-transition:transform .3s ease-out,background-color .3s ease-out;-webkit-transition:transform .3s ease-out,background-color .3s ease-out;-o-transition:transform .3s ease-out,background-color .3s ease-out;-ms-transition:transform .3s ease-out,background-color .3s ease-out}.photo-container[_ngcontent-%COMP%]{width:inherit;height:inherit;overflow:hidden}.photo-name[_ngcontent-%COMP%]{display:inline-block}.photo-position[_ngcontent-%COMP%]{display:inline-block;float:right}a[_ngcontent-%COMP%]{color:#fff}.photo-keywords[_ngcontent-%COMP%]{margin-top:5px;font-size:small;text-align:right;display:inline-block;width:100%}.video-indicator[_ngcontent-%COMP%]{font-size:large;padding:5px;position:absolute;top:0;right:0;white-space:nowrap;border-bottom-left-radius:15px!important;background-color:#00000080;color:#fff;transition:background-color .3s ease-out;-moz-transition:background-color .3s ease-out;-webkit-transition:background-color .3s ease-out;-o-transition:background-color .3s ease-out;-ms-transition:background-color .3s ease-out}.photo-container[_ngcontent-%COMP%]:hover   .video-indicator[_ngcontent-%COMP%]{background-color:#000c}.photo-keywords[_ngcontent-%COMP%]   .oi-person[_ngcontent-%COMP%]{margin-right:2px}\"]\n  });\n  return GalleryPhotoComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}