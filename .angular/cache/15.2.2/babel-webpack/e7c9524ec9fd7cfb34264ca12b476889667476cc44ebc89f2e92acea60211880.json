{"ast":null,"code":"import { EventEmitter, forwardRef } from '@angular/core';\nimport { SearchQueryTypes } from '../../../../../../common/entities/SearchQueryDTO';\nimport { NG_VALIDATORS, NG_VALUE_ACCESSOR, UntypedFormControl, ValidationErrors } from '@angular/forms';\nimport { SearchQueryParserService } from '../search-query-parser.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../search-query-parser.service\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"../query-enrty/query-entry.search.gallery.component\";\nimport * as i4 from \"../search-field-base/search-field-base.gallery.component\";\nexport let GallerySearchQueryBuilderComponent = /*#__PURE__*/(() => {\n  class GallerySearchQueryBuilderComponent {\n    constructor(searchQueryParserService) {\n      this.searchQueryParserService = searchQueryParserService;\n      this.searchQueryDTO = {\n        type: SearchQueryTypes.any_text,\n        text: ''\n      };\n      this.search = new EventEmitter();\n      this.placeholder = $localize`Search`;\n      this.rawSearchText = '';\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      this.propagateChange = _ => {};\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      this.propagateTouch = _ => {};\n    }\n    validateRawSearchText() {\n      try {\n        this.searchQueryDTO = this.searchQueryParserService.parse(this.rawSearchText);\n        this.onChange();\n      } catch (e) {\n        console.error(e);\n      }\n    }\n    resetQuery() {\n      this.searchQueryDTO = {\n        text: '',\n        type: SearchQueryTypes.any_text\n      };\n      this.onChange();\n    }\n    validate(control) {\n      return {\n        required: true\n      };\n    }\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    onTouched() {}\n    writeValue(obj) {\n      this.searchQueryDTO = obj;\n      this.rawSearchText = this.searchQueryParserService.stringify(this.searchQueryDTO);\n    }\n    registerOnChange(fn) {\n      this.propagateChange = fn;\n    }\n    registerOnTouched(fn) {\n      this.propagateTouch = fn;\n    }\n    onChange() {\n      this.rawSearchText = this.searchQueryParserService.stringify(this.searchQueryDTO);\n      this.propagateChange(this.searchQueryDTO);\n    }\n  }\n  GallerySearchQueryBuilderComponent.ɵfac = function GallerySearchQueryBuilderComponent_Factory(t) {\n    return new (t || GallerySearchQueryBuilderComponent)(i0.ɵɵdirectiveInject(i1.SearchQueryParserService));\n  };\n  GallerySearchQueryBuilderComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: GallerySearchQueryBuilderComponent,\n    selectors: [[\"app-gallery-search-query-builder\"]],\n    inputs: {\n      placeholder: \"placeholder\"\n    },\n    outputs: {\n      search: \"search\"\n    },\n    features: [i0.ɵɵProvidersFeature([{\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => GallerySearchQueryBuilderComponent),\n      multi: true\n    }, {\n      provide: NG_VALIDATORS,\n      useExisting: forwardRef(() => GallerySearchQueryBuilderComponent),\n      multi: true\n    }])],\n    decls: 3,\n    vars: 3,\n    consts: [[\"name\", \"form-search-field\", 1, \"rounded-2\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\", \"search\"], [\"name\", \"search-root\", 3, \"ngModel\", \"ngModelChange\", \"change\", \"delete\"]],\n    template: function GallerySearchQueryBuilderComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"app-gallery-search-field-base\", 0);\n        i0.ɵɵlistener(\"ngModelChange\", function GallerySearchQueryBuilderComponent_Template_app_gallery_search_field_base_ngModelChange_0_listener($event) {\n          return ctx.rawSearchText = $event;\n        })(\"ngModelChange\", function GallerySearchQueryBuilderComponent_Template_app_gallery_search_field_base_ngModelChange_0_listener() {\n          return ctx.validateRawSearchText();\n        })(\"search\", function GallerySearchQueryBuilderComponent_Template_app_gallery_search_field_base_search_0_listener() {\n          return ctx.search.emit();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(1, \"hr\");\n        i0.ɵɵelementStart(2, \"app-gallery-search-query-entry\", 1);\n        i0.ɵɵlistener(\"ngModelChange\", function GallerySearchQueryBuilderComponent_Template_app_gallery_search_query_entry_ngModelChange_2_listener($event) {\n          return ctx.searchQueryDTO = $event;\n        })(\"change\", function GallerySearchQueryBuilderComponent_Template_app_gallery_search_query_entry_change_2_listener() {\n          return ctx.onChange();\n        })(\"ngModelChange\", function GallerySearchQueryBuilderComponent_Template_app_gallery_search_query_entry_ngModelChange_2_listener() {\n          return ctx.onChange();\n        })(\"delete\", function GallerySearchQueryBuilderComponent_Template_app_gallery_search_query_entry_delete_2_listener() {\n          return ctx.resetQuery();\n        });\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngModel\", ctx.rawSearchText)(\"placeholder\", ctx.placeholder);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.searchQueryDTO);\n      }\n    },\n    dependencies: [i2.NgControlStatus, i2.NgModel, i3.GallerySearchQueryEntryComponent, i4.GallerySearchFieldBaseComponent],\n    styles: [\".autocomplete-list[_ngcontent-%COMP%]{position:absolute;left:0;top:34px;background-color:#fff;width:100%;border:1px solid #ccc;border-bottom-left-radius:4px;border-bottom-right-radius:4px;padding:5px 0;box-shadow:0 6px 12px #0000002d;z-index:7}.insert-button[_ngcontent-%COMP%]{margin-right:-15px;display:none;margin-top:2px}.autocomplete-item-selected[_ngcontent-%COMP%]   .insert-button[_ngcontent-%COMP%]{display:block}@media (hover: none){.insert-button[_ngcontent-%COMP%]{display:block}}.autocomplete-item-selected[_ngcontent-%COMP%]   .insert-button[_ngcontent-%COMP%]:hover{color:#000}.autocomplete-item[_ngcontent-%COMP%]{cursor:pointer;padding-top:2px;padding-bottom:2px;font-size:17px}.autocomplete-item[_ngcontent-%COMP%]{color:#333;padding:0 20px;line-height:1.42857143;font-weight:400;display:block}.autocomplete-item-selected[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff}.search-text[_ngcontent-%COMP%]{z-index:6;width:100%;background:transparent}.search-hint[_ngcontent-%COMP%]{left:0;z-index:1;width:100%;position:absolute;margin-left:0!important}\"]\n  });\n  return GallerySearchQueryBuilderComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}