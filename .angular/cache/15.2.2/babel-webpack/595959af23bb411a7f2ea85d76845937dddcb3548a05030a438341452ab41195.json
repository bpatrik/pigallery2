{"ast":null,"code":"import _asyncToGenerator from \"E:/work/pigallery2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { EventEmitter, forwardRef, TemplateRef } from '@angular/core';\nimport { Router, RouterLink } from '@angular/router';\nimport { AutoCompleteService } from '../autocomplete.service';\nimport { UntypedFormControl, NG_VALIDATORS, NG_VALUE_ACCESSOR, ValidationErrors } from '@angular/forms';\nimport { SearchQueryParserService } from '../search-query-parser.service';\nimport { BsModalService } from '../../../../../../../node_modules/ngx-bootstrap/modal';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../autocomplete.service\";\nimport * as i2 from \"../search-query-parser.service\";\nimport * as i3 from \"../../../../../../../node_modules/ngx-bootstrap/modal\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"../search-field-base/search-field-base.gallery.component\";\nimport * as i7 from \"../query-builder/query-bulder.gallery.component\";\nfunction GallerySearchFieldComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"h5\", 7);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function GallerySearchFieldComponent_ng_template_5_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.hideSearchModal());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 9)(5, \"form\", 10, 11)(7, \"app-gallery-search-query-builder\", 12);\n    i0.ɵɵlistener(\"ngModelChange\", function GallerySearchFieldComponent_ng_template_5_Template_app_gallery_search_query_builder_ngModelChange_7_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.searchQueryDTO = $event);\n    })(\"change\", function GallerySearchFieldComponent_ng_template_5_Template_app_gallery_search_query_builder_change_7_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.onQueryChange());\n    })(\"search\", function GallerySearchFieldComponent_ng_template_5_Template_app_gallery_search_query_builder_search_7_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.search.emit());\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.placeholder);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.searchQueryDTO)(\"placeholder\", ctx_r1.placeholder);\n  }\n}\nexport let GallerySearchFieldComponent = /*#__PURE__*/(() => {\n  class GallerySearchFieldComponent {\n    constructor(autoCompleteService, searchQueryParserService, modalService, router) {\n      this.autoCompleteService = autoCompleteService;\n      this.searchQueryParserService = searchQueryParserService;\n      this.modalService = modalService;\n      this.router = router;\n      this.search = new EventEmitter();\n      this.rawSearchText = '';\n      this.propagateChange = _ => {\n        //ignoring\n      };\n      this.propagateTouch = _ => {\n        //ignoring\n      };\n    }\n    openSearchModal(template) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.searchModalRef = _this.modalService.show(template, {\n          class: 'modal-lg'\n        });\n        document.body.style.paddingRight = '0px';\n      })();\n    }\n    hideSearchModal() {\n      this.searchModalRef.hide();\n      this.searchModalRef = null;\n    }\n    onTouched() {\n      //ignoring\n    }\n    writeValue(obj) {\n      this.searchQueryDTO = obj;\n      this.rawSearchText = this.searchQueryParserService.stringify(this.searchQueryDTO);\n    }\n    registerOnChange(fn) {\n      this.propagateChange = fn;\n    }\n    registerOnTouched(fn) {\n      this.propagateTouch = fn;\n    }\n    onChange() {\n      this.propagateChange(this.searchQueryDTO);\n    }\n    validate(control) {\n      return {\n        required: true\n      };\n    }\n    onQueryChange() {\n      this.rawSearchText = this.searchQueryParserService.stringify(this.searchQueryDTO);\n      this.onChange();\n    }\n    validateRawSearchText() {\n      try {\n        this.searchQueryDTO = this.searchQueryParserService.parse(this.rawSearchText);\n        this.onChange();\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }\n  GallerySearchFieldComponent.ɵfac = function GallerySearchFieldComponent_Factory(t) {\n    return new (t || GallerySearchFieldComponent)(i0.ɵɵdirectiveInject(i1.AutoCompleteService), i0.ɵɵdirectiveInject(i2.SearchQueryParserService), i0.ɵɵdirectiveInject(i3.BsModalService), i0.ɵɵdirectiveInject(i4.Router));\n  };\n  GallerySearchFieldComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: GallerySearchFieldComponent,\n    selectors: [[\"app-gallery-search-field\"]],\n    inputs: {\n      placeholder: \"placeholder\"\n    },\n    outputs: {\n      search: \"search\"\n    },\n    features: [i0.ɵɵProvidersFeature([AutoCompleteService, RouterLink, {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => GallerySearchFieldComponent),\n      multi: true\n    }, {\n      provide: NG_VALIDATORS,\n      useExisting: forwardRef(() => GallerySearchFieldComponent),\n      multi: true\n    }])],\n    decls: 7,\n    vars: 2,\n    consts: [[1, \"input-group\"], [\"name\", \"search-field\", 1, \"search-field\", \"col\", \"p-0\", \"rounded-start-2\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\", \"search\"], [1, \"input-group-btn\", \"col-auto\", \"pe-0\", 2, \"display\", \"block\"], [\"type\", \"button\", 1, \"btn\", \"btn-light\", 3, \"click\"], [1, \"oi\", \"oi-chevron-bottom\"], [\"searchModal\", \"\"], [1, \"modal-header\"], [1, \"modal-title\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"btn-close\", 3, \"click\"], [1, \"modal-body\"], [1, \"form-horizontal\"], [\"searchPanelForm\", \"ngForm\"], [\"name\", \"search-query-builder\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\", \"change\", \"search\"]],\n    template: function GallerySearchFieldComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r8 = i0.ɵɵgetCurrentView();\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"app-gallery-search-field-base\", 1);\n        i0.ɵɵlistener(\"ngModelChange\", function GallerySearchFieldComponent_Template_app_gallery_search_field_base_ngModelChange_1_listener($event) {\n          return ctx.rawSearchText = $event;\n        })(\"ngModelChange\", function GallerySearchFieldComponent_Template_app_gallery_search_field_base_ngModelChange_1_listener() {\n          return ctx.validateRawSearchText();\n        })(\"search\", function GallerySearchFieldComponent_Template_app_gallery_search_field_base_search_1_listener() {\n          return ctx.search.emit();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(2, \"div\", 2)(3, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function GallerySearchFieldComponent_Template_button_click_3_listener() {\n          i0.ɵɵrestoreView(_r8);\n          const _r0 = i0.ɵɵreference(6);\n          return i0.ɵɵresetView(ctx.openSearchModal(_r0));\n        });\n        i0.ɵɵelement(4, \"span\", 4);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(5, GallerySearchFieldComponent_ng_template_5_Template, 8, 3, \"ng-template\", null, 5, i0.ɵɵtemplateRefExtractor);\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngModel\", ctx.rawSearchText)(\"placeholder\", ctx.placeholder);\n      }\n    },\n    dependencies: [i5.ɵNgNoValidate, i5.NgControlStatus, i5.NgControlStatusGroup, i5.NgModel, i5.NgForm, i6.GallerySearchFieldBaseComponent, i7.GallerySearchQueryBuilderComponent],\n    styles: [\".autocomplete-list[_ngcontent-%COMP%]{position:absolute;left:0;top:34px;background-color:#fff;width:100%;border:1px solid #ccc;border-bottom-left-radius:4px;border-bottom-right-radius:4px;padding:5px 0;box-shadow:0 6px 12px #0000002d;z-index:7}.insert-button[_ngcontent-%COMP%]{margin-right:-15px;display:none;margin-top:2px}.autocomplete-item-selected[_ngcontent-%COMP%]   .insert-button[_ngcontent-%COMP%]{display:block}@media (hover: none){.insert-button[_ngcontent-%COMP%]{display:block}}.autocomplete-item-selected[_ngcontent-%COMP%]   .insert-button[_ngcontent-%COMP%]:hover{color:#000}.autocomplete-item[_ngcontent-%COMP%]{cursor:pointer;padding-top:2px;padding-bottom:2px;font-size:17px}.autocomplete-item[_ngcontent-%COMP%]{color:#333;padding:0 20px;line-height:1.42857143;font-weight:400;display:block}.autocomplete-item-selected[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff}.search-text[_ngcontent-%COMP%]{z-index:6;width:100%;background:transparent}.search-hint[_ngcontent-%COMP%]{left:0;z-index:1;width:100%;position:absolute;margin-left:0!important}\"]\n  });\n  return GallerySearchFieldComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}