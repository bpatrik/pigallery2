{"ast":null,"code":"import { TemplateRef } from '@angular/core';\nimport { ContentService } from '../content.service';\nimport { Config } from '../../../../../common/config/public/Config';\nimport { NotificationService } from '../../../model/notification.service';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { NetworkService } from '../../../model/network/network.service';\nimport { SearchQueryTypes } from '../../../../../common/entities/SearchQueryDTO';\nimport { ActivatedRoute } from '@angular/router';\nimport { QueryParams } from '../../../../../common/QueryParams';\nimport { SearchQueryParserService } from '../search/search-query-parser.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../content.service\";\nimport * as i2 from \"../../../model/notification.service\";\nimport * as i3 from \"../search/search-query-parser.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"ngx-bootstrap/modal\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"ngx-clipboard\";\nimport * as i8 from \"../search/query-builder/query-bulder.gallery.component\";\nfunction RandomQueryBuilderGalleryComponent_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4)(1, \"h5\", 5);\n    i0.ɵɵi18n(2, 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function RandomQueryBuilderGalleryComponent_ng_template_4_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.hideModal());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 8)(5, \"div\", 9)(6, \"div\", 10);\n    i0.ɵɵelement(7, \"input\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 12)(9, \"button\", 13);\n    i0.ɵɵlistener(\"cbOnSuccess\", function RandomQueryBuilderGalleryComponent_ng_template_4_Template_button_cbOnSuccess_9_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.onCopy());\n    });\n    i0.ɵɵi18n(10, 14);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(11, \"hr\");\n    i0.ɵɵelementStart(12, \"form\", 15, 16)(14, \"app-gallery-search-query-builder\", 17);\n    i0.ɵɵlistener(\"ngModelChange\", function RandomQueryBuilderGalleryComponent_ng_template_4_Template_app_gallery_search_query_builder_ngModelChange_14_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.searchQueryDTO = $event);\n    })(\"change\", function RandomQueryBuilderGalleryComponent_ng_template_4_Template_app_gallery_search_query_builder_change_14_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.onQueryChange());\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.url);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"cbContent\", ctx_r1.url);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.searchQueryDTO);\n  }\n}\nexport let RandomQueryBuilderGalleryComponent = /*#__PURE__*/(() => {\n  class RandomQueryBuilderGalleryComponent {\n    constructor(galleryService, notification, searchQueryParserService, route, modalService) {\n      this.galleryService = galleryService;\n      this.notification = notification;\n      this.searchQueryParserService = searchQueryParserService;\n      this.route = route;\n      this.modalService = modalService;\n      this.searchQueryDTO = {\n        type: SearchQueryTypes.any_text,\n        text: ''\n      };\n      this.enabled = true;\n      this.url = '';\n      this.contentSubscription = null;\n      this.subscription = null;\n      this.subscription = this.route.params.subscribe(params => {\n        if (!params[QueryParams.gallery.search.query]) {\n          return;\n        }\n        const searchQuery = JSON.parse(params[QueryParams.gallery.search.query]);\n        if (searchQuery) {\n          this.searchQueryDTO = searchQuery;\n          this.onQueryChange();\n        }\n      });\n    }\n    get HTMLSearchQuery() {\n      return JSON.stringify(this.searchQueryDTO);\n    }\n    onQueryChange() {\n      this.url = NetworkService.buildUrl(Config.Server.publicUrl + Config.Server.apiPath + '/gallery/random/' + this.HTMLSearchQuery);\n    }\n    ngOnInit() {\n      this.contentSubscription = this.galleryService.content.subscribe(content => {\n        this.enabled = !!content.directory;\n        if (!this.enabled) {\n          return;\n        }\n        // this.data.directory = Utils.concatUrls((<DirectoryDTO>content.directory).path, (<DirectoryDTO>content.directory).name);\n      });\n    }\n\n    ngOnDestroy() {\n      if (this.contentSubscription !== null) {\n        this.contentSubscription.unsubscribe();\n      }\n      if (this.subscription !== null) {\n        this.subscription.unsubscribe();\n      }\n    }\n    openModal(template) {\n      if (!this.enabled) {\n        return;\n      }\n      if (this.modalRef) {\n        this.modalRef.hide();\n      }\n      this.modalRef = this.modalService.show(template, {\n        class: 'modal-lg'\n      });\n      document.body.style.paddingRight = '0px';\n      this.onQueryChange();\n      return false;\n    }\n    onCopy() {\n      this.notification.success($localize`Url has been copied to clipboard`);\n    }\n    hideModal() {\n      this.modalRef.hide();\n      this.modalRef = null;\n    }\n  }\n  RandomQueryBuilderGalleryComponent.ɵfac = function RandomQueryBuilderGalleryComponent_Factory(t) {\n    return new (t || RandomQueryBuilderGalleryComponent)(i0.ɵɵdirectiveInject(i1.ContentService), i0.ɵɵdirectiveInject(i2.NotificationService), i0.ɵɵdirectiveInject(i3.SearchQueryParserService), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i5.BsModalService));\n  };\n  RandomQueryBuilderGalleryComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: RandomQueryBuilderGalleryComponent,\n    selectors: [[\"app-gallery-random-query-builder\"]],\n    decls: 6,\n    vars: 3,\n    consts: function () {\n      let i18n_0;\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        /**\r\n         * @suppress {msgDescriptions}\r\n         */\n        const MSG_EXTERNAL_3445823735428564189$$SRC_FRONTEND_APP_UI_GALLERY_RANDOM_QUERY_BUILDER_RANDOM_QUERY_BUILDER_GALLERY_COMPONENT_TS_1 = goog.getMsg(\"Random link\");\n        i18n_0 = MSG_EXTERNAL_3445823735428564189$$SRC_FRONTEND_APP_UI_GALLERY_RANDOM_QUERY_BUILDER_RANDOM_QUERY_BUILDER_GALLERY_COMPONENT_TS_1;\n      } else {\n        i18n_0 = $localize`Random link`;\n      }\n      let i18n_2;\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        /**\r\n         * @suppress {msgDescriptions}\r\n         */\n        const MSG_EXTERNAL_6692759234829188012$$SRC_FRONTEND_APP_UI_GALLERY_RANDOM_QUERY_BUILDER_RANDOM_QUERY_BUILDER_GALLERY_COMPONENT_TS__3 = goog.getMsg(\"Random Link creator\");\n        i18n_2 = MSG_EXTERNAL_6692759234829188012$$SRC_FRONTEND_APP_UI_GALLERY_RANDOM_QUERY_BUILDER_RANDOM_QUERY_BUILDER_GALLERY_COMPONENT_TS__3;\n      } else {\n        i18n_2 = $localize`Random Link creator`;\n      }\n      let i18n_4;\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        /**\r\n         * @suppress {msgDescriptions}\r\n         */\n        const MSG_EXTERNAL_6402185104981597904$$SRC_FRONTEND_APP_UI_GALLERY_RANDOM_QUERY_BUILDER_RANDOM_QUERY_BUILDER_GALLERY_COMPONENT_TS__5 = goog.getMsg(\"Copy \");\n        i18n_4 = MSG_EXTERNAL_6402185104981597904$$SRC_FRONTEND_APP_UI_GALLERY_RANDOM_QUERY_BUILDER_RANDOM_QUERY_BUILDER_GALLERY_COMPONENT_TS__5;\n      } else {\n        i18n_4 = $localize`Copy `;\n      }\n      return [[3, \"click\"], [1, \"oi\", \"oi-random\"], i18n_0, [\"randomModal\", \"\"], [1, \"modal-header\"], [1, \"modal-title\"], i18n_2, [\"type\", \"button\", \"data-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"btn-close\", 3, \"click\"], [1, \"modal-body\"], [1, \"row\"], [1, \"col-7\", \"col-sm-9\"], [\"id\", \"randomLink\", \"name\", \"randomLink\", \"placeholder\", \"link\", \"type\", \"text\", 1, \"form-control\", \"input-md\", 3, \"ngModel\"], [1, \"col-5\", \"col-sm-3\"], [\"id\", \"copyButton\", \"name\", \"copyButton\", \"ngxClipboard\", \"\", 1, \"btn\", \"btn-primary\", \"btn-block\", 3, \"cbContent\", \"cbOnSuccess\"], i18n_4, [1, \"form-horizontal\"], [\"searchPanelForm\", \"ngForm\"], [\"id\", \"album-search-query-builder\", \"name\", \"album-search-query-builder\", 3, \"ngModel\", \"ngModelChange\", \"change\"]];\n    },\n    template: function RandomQueryBuilderGalleryComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r8 = i0.ɵɵgetCurrentView();\n        i0.ɵɵelementStart(0, \"button\", 0);\n        i0.ɵɵlistener(\"click\", function RandomQueryBuilderGalleryComponent_Template_button_click_0_listener() {\n          i0.ɵɵrestoreView(_r8);\n          const _r0 = i0.ɵɵreference(5);\n          return i0.ɵɵresetView(ctx.openModal(_r0));\n        });\n        i0.ɵɵelement(1, \"span\", 1);\n        i0.ɵɵelementContainerStart(2);\n        i0.ɵɵi18n(3, 2);\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(4, RandomQueryBuilderGalleryComponent_ng_template_4_Template, 15, 3, \"ng-template\", null, 3, i0.ɵɵtemplateRefExtractor);\n      }\n      if (rf & 2) {\n        i0.ɵɵclassMapInterpolate1(\"dropdown-item \", ctx.enabled ? \"\" : \"disabled\", \"\");\n      }\n    },\n    dependencies: [i6.ɵNgNoValidate, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgControlStatusGroup, i6.NgModel, i6.NgForm, i7.ClipboardDirective, i8.GallerySearchQueryBuilderComponent],\n    styles: [\".modal[_ngcontent-%COMP%]{z-index:9999}.full-width[_ngcontent-%COMP%]{width:100%}.row[_ngcontent-%COMP%]{padding-top:1px;padding-bottom:1px}button.disabled[_ngcontent-%COMP%]{color:gray;pointer-events:none}button.dropdown-item[_ngcontent-%COMP%]{padding:.3rem 1rem .3rem .8rem}button.dropdown-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-right:.8rem}\"]\n  });\n  return RandomQueryBuilderGalleryComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}