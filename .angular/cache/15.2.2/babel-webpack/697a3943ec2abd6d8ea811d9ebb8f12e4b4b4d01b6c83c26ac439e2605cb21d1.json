{"ast":null,"code":"import _asyncToGenerator from \"E:/work/pigallery2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { EventEmitter } from '@angular/core';\nimport { JobProgressStates } from '../../../../../../common/entities/job/JobProgressDTO';\nimport { ScheduledJobsService } from '../../scheduled-jobs.service';\nimport { NotificationService } from '../../../../model/notification.service';\nimport { JobDTOUtils } from '../../../../../../common/entities/job/JobDTO';\nimport { BackendtextService } from '../../../../model/backendtext.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../model/notification.service\";\nimport * as i2 from \"../../scheduled-jobs.service\";\nimport * as i3 from \"../../../../model/backendtext.service\";\nimport * as i4 from \"@angular/common\";\nfunction JobButtonComponent_button_0_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 5);\n    i0.ɵɵelementContainerStart(1);\n    i0.ɵɵi18n(2, 6);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\": \", ctx_r2.backendTextService.getJobName(ctx_r2.jobName), \"\");\n  }\n}\nfunction JobButtonComponent_button_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 2);\n    i0.ɵɵlistener(\"click\", function JobButtonComponent_button_0_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.start());\n    });\n    i0.ɵɵtemplate(1, JobButtonComponent_button_0_span_1_Template, 4, 1, \"span\", 3);\n    i0.ɵɵelement(2, \"span\", 4);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassMapInterpolate1(\"btn \", ctx_r0.danger ? \"btn-danger\" : \"btn-success\", \"\");\n    i0.ɵɵproperty(\"disabled\", ctx_r0.disabled || ctx_r0.jobsService.jobStartingStopping[ctx_r0.jobName]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.shortName);\n  }\n}\nfunction JobButtonComponent_button_1_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 10);\n    i0.ɵɵelementContainerStart(1);\n    i0.ɵɵi18n(2, 11);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\": \", ctx_r5.backendTextService.getJobName(ctx_r5.jobName), \"\");\n  }\n}\nfunction JobButtonComponent_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function JobButtonComponent_button_1_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.stop());\n    });\n    i0.ɵɵelement(1, \"span\", 8);\n    i0.ɵɵtemplate(2, JobButtonComponent_button_1_span_2_Template, 4, 1, \"span\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"disabled\", ctx_r1.disabled || ctx_r1.jobsService.jobStartingStopping[ctx_r1.jobName] || ctx_r1.Progress.state !== ctx_r1.JobProgressStates.running);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.shortName);\n  }\n}\nexport let JobButtonComponent = /*#__PURE__*/(() => {\n  class JobButtonComponent {\n    constructor(notification, jobsService, backendTextService) {\n      this.notification = notification;\n      this.jobsService = jobsService;\n      this.backendTextService = backendTextService;\n      this.shortName = false;\n      this.disabled = false;\n      this.soloRun = false;\n      this.allowParallelRun = false;\n      this.danger = false;\n      this.JobProgressStates = JobProgressStates;\n      this.jobError = new EventEmitter();\n    }\n    populateConfig() {\n      if (this.config) {\n        return;\n      }\n      const c = this.jobsService.getDefaultConfig(this.jobName); // can return with null\n      if (c) {\n        this.config = c;\n      }\n    }\n    get Running() {\n      return this.Progress && (this.Progress.state === JobProgressStates.running || this.Progress.state === JobProgressStates.cancelling);\n    }\n    get Progress() {\n      this.populateConfig();\n      return this.jobsService.progress.value[JobDTOUtils.getHashName(this.jobName, this.config)];\n    }\n    start() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.jobError.emit('');\n        _this.populateConfig();\n        try {\n          yield _this.jobsService.start(_this.jobName, _this.config, _this.soloRun, _this.allowParallelRun);\n          _this.notification.success($localize`Job started` + ': ' + _this.backendTextService.getJobName(_this.jobName));\n          return true;\n        } catch (err) {\n          console.log(err);\n          if (err.message) {\n            _this.jobError.emit(err.message);\n          }\n        }\n        return false;\n      })();\n    }\n    stop() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        _this2.jobError.emit('');\n        try {\n          yield _this2.jobsService.stop(_this2.jobName);\n          _this2.notification.info($localize`Stopping job` + ': ' + _this2.backendTextService.getJobName(_this2.jobName));\n          return true;\n        } catch (err) {\n          console.error(err);\n          if (err.message) {\n            _this2.jobError.emit(err.message);\n          }\n        }\n        return false;\n      })();\n    }\n  }\n  JobButtonComponent.ɵfac = function JobButtonComponent_Factory(t) {\n    return new (t || JobButtonComponent)(i0.ɵɵdirectiveInject(i1.NotificationService), i0.ɵɵdirectiveInject(i2.ScheduledJobsService), i0.ɵɵdirectiveInject(i3.BackendtextService));\n  };\n  JobButtonComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: JobButtonComponent,\n    selectors: [[\"app-settings-job-button\"]],\n    inputs: {\n      jobName: \"jobName\",\n      config: \"config\",\n      shortName: \"shortName\",\n      disabled: \"disabled\",\n      soloRun: \"soloRun\",\n      allowParallelRun: \"allowParallelRun\",\n      danger: \"danger\"\n    },\n    outputs: {\n      jobError: \"jobError\"\n    },\n    decls: 2,\n    vars: 2,\n    consts: function () {\n      let i18n_0;\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        /**\r\n         * @suppress {msgDescriptions}\r\n         */\n        const MSG_EXTERNAL_9128681615749206002$$SRC_FRONTEND_APP_UI_SETTINGS_WORKFLOW_BUTTON_JOB_BUTTON_SETTINGS_COMPONENT_TS_1 = goog.getMsg(\"Trigger job run manually\");\n        i18n_0 = MSG_EXTERNAL_9128681615749206002$$SRC_FRONTEND_APP_UI_SETTINGS_WORKFLOW_BUTTON_JOB_BUTTON_SETTINGS_COMPONENT_TS_1;\n      } else {\n        i18n_0 = $localize`Trigger job run manually`;\n      }\n      let i18n_2;\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        /**\r\n         * @suppress {msgDescriptions}\r\n         */\n        const MSG_EXTERNAL_1442537757726795809$$SRC_FRONTEND_APP_UI_SETTINGS_WORKFLOW_BUTTON_JOB_BUTTON_SETTINGS_COMPONENT_TS___3 = goog.getMsg(\"Run now\");\n        i18n_2 = MSG_EXTERNAL_1442537757726795809$$SRC_FRONTEND_APP_UI_SETTINGS_WORKFLOW_BUTTON_JOB_BUTTON_SETTINGS_COMPONENT_TS___3;\n      } else {\n        i18n_2 = $localize`Run now`;\n      }\n      let i18n_4;\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        /**\r\n         * @suppress {msgDescriptions}\r\n         */\n        const MSG_EXTERNAL_2159130950882492111$$SRC_FRONTEND_APP_UI_SETTINGS_WORKFLOW_BUTTON_JOB_BUTTON_SETTINGS_COMPONENT_TS___5 = goog.getMsg(\"Cancel\");\n        i18n_4 = MSG_EXTERNAL_2159130950882492111$$SRC_FRONTEND_APP_UI_SETTINGS_WORKFLOW_BUTTON_JOB_BUTTON_SETTINGS_COMPONENT_TS___5;\n      } else {\n        i18n_4 = $localize`Cancel`;\n      }\n      return [[\"title\", i18n_0, 3, \"class\", \"disabled\", \"click\", 4, \"ngIf\"], [\"class\", \"btn btn-secondary\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [\"title\", i18n_0, 3, \"disabled\", \"click\"], [\"class\", \"me-2\", 4, \"ngIf\"], [1, \"oi\", \"oi-media-play\"], [1, \"me-2\"], i18n_2, [1, \"btn\", \"btn-secondary\", 3, \"disabled\", \"click\"], [1, \"oi\", \"oi-media-stop\"], [\"class\", \"ms-2\", 4, \"ngIf\"], [1, \"ms-2\"], i18n_4];\n    },\n    template: function JobButtonComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, JobButtonComponent_button_0_Template, 3, 5, \"button\", 0);\n        i0.ɵɵtemplate(1, JobButtonComponent_button_1_Template, 3, 2, \"button\", 1);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", !ctx.Running);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.Running);\n      }\n    },\n    dependencies: [i4.NgIf]\n  });\n  return JobButtonComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}